import{_ as ne,c as y,d as b,e as u,t as T,l as z,x as oe,u as se,a as ie,r as k,o as re,w as ce,b as f,f as a,j as m,i as _,g as s,h as ue,s as S,F as $,k as E,m as H,n as de,p as pe,q as P,y as me,z as _e}from"./index-42e38403.js";import{a as D,M as fe,S as N}from"./sweetalert2-d7d40c35.js";const ve={name:"PlusIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},ye=["aria-hidden","aria-label"],ge=["fill","width","height"],he={d:"M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"},be={key:0};function xe(g,c,l,d,r,v){return y(),b("span",oe(g.$attrs,{"aria-hidden":l.title?null:!0,"aria-label":l.title,class:"material-design-icon plus-icon",role:"img",onClick:c[0]||(c[0]=n=>g.$emit("click",n))}),[(y(),b("svg",{fill:l.fillColor,class:"material-design-icon__svg",width:l.size,height:l.size,viewBox:"0 0 24 24"},[u("path",he,[l.title?(y(),b("title",be,T(l.title),1)):z("",!0)])],8,ge))],16,ye)}const ke=ne(ve,[["render",xe]]),Ve=async(g,c,l)=>D.get("getAll",{params:{search:g,page:c,pageSize:l}}).then(d=>d.data),Ce=async g=>D.post("drafts",g).then(c=>c.data),Se=async(g,c)=>D.put(`drafts/${c}`,g).then(l=>l.data),we=async g=>D.post("moveToHistory",g).then(c=>c.data);const qe={class:"home"},ze=u("div",{class:"title_part h-25",style:{width:"fit-content","border-radius":"4px","background-color":"grey",padding:"8px 16px",color:"#fff"}},[u("h1",null,"Главная")],-1),Te={class:"create_part w-100 my-3 d-flex justify-end"},De={class:"search_part w-100 my-3"},Fe={class:"table_part"},$e={class:"text-left"},Ee=["onClick"],He={class:"d-flex align-center justify-space-evenly"},Pe={key:1},Ne=u("td",{class:"text-center my-4",style:{"font-weight":"600"}}," Ничего не найдено ",-1),Be=[Ne],Ue={class:"w-100 d-flex align-center justify-end my-3"},je={class:"text mr-3"},Re={__name:"Home",setup(g){const c=se(),l=ie();let d=k(Number(l.query.page)||1),r=k(!1),v=k(!1),n=k(null),V=k(l.query.search||"");const Z=["10","20","50","100"],w=k(l.query.pageSize||10),F=k(0),C=k([]),q=async()=>{const i=await Ve(l.query.search,l.query.page,l.query.pageSize);F.value=i.total,C.value=i.search};re(async()=>{await q()}),ce(()=>({search:l.query.search,page:l.query.page,pageSize:l.query.pageSize}),async()=>{await q()});const J=async i=>{w.value=i,c.push({query:{search:l.query.search,page:l.query.page,pageSize:i}})},O=async i=>{d.value=i,c.push({query:{search:l.query.search,page:i,pageSize:l.query.pageSize}})},Q=async i=>{if(n.value!==null){const e=new FormData(i.currentTarget),o={name:e.get("fio"),phone:e.get("phone"),pinfl:e.get("pinfl"),note:e.get("note"),created_by:e.get("created_by")};o.name&&o.phone&&o.pinfl&&o.created_by&&o.note?await Se(o,n.value.id)&&(r.value=!1,N.fire({title:"Успех",text:"Запись изменено",icon:"success"}),q()):console.log("Fill all fields")}else{const e=new FormData(i.currentTarget),o={name:e.get("fio"),phone:e.get("phone"),pinfl:e.get("pinfl"),note:e.get("note"),created_by:e.get("created_by")};o.name&&o.phone&&o.pinfl&&o.created_by&&o.note?await Ce(o)&&(r.value=!1,N.fire({title:"Успех",text:"Запись создана",icon:"success"}),q()):console.log("Fill all fields")}},W=async i=>{const e=new FormData(i.currentTarget),o={id:n.value.id,end_by:e.get("operator_number")};o.end_by?await we(o)&&(v.value=!1,N.fire({title:"Успех",text:"Запись завершена",icon:"success"}),q()):console.log("Fill all fields")},X=async i=>{if(navigator.clipboard)try{await navigator.clipboard.writeText(i),alert("Text copied to clipboard!")}catch(e){console.error("Failed to copy text: ",e)}else{const e=document.createElement("textarea");e.value=i,e.style.position="absolute",e.style.left="-999999px",document.body.prepend(e),e.select();try{document.execCommand("copy")}catch(o){console.error(o)}finally{e.remove()}}},B=[{title:"№",key:"id"},{title:"ФИО",key:"name"},{title:"Телефон",key:"phone"},{title:"Пинфл",key:"pinfl"},{title:"Примечание",key:"note"},{title:"Создано",key:"created_at"},{title:"Оператор создал",key:"created_by"},{title:"Действия",key:"actions"}];return(i,e)=>{const o=f("v-btn"),h=f("v-text-field"),Y=f("v-tooltip"),U=f("v-icon"),ee=f("v-table"),te=f("v-select"),le=f("v-pagination"),ae=f("v-textarea"),j=f("v-spacer"),M=f("v-card-actions"),A=f("v-form"),R=f("v-card"),G=f("v-dialog");return y(),b("section",qe,[ze,u("div",Te,[a(o,{color:"info","prepend-icon":ke,class:"d-flex align-center justify-center",onClick:e[0]||(e[0]=t=>(_(r)?r.value=!0:r=!0,_(n)?n.value=null:n=null))},{default:m(()=>[S("Создать")]),_:1})]),u("div",De,[a(h,{"onClick:appendInner":e[1]||(e[1]=t=>(s(c).push({query:{search:s(V),page:1,pageSize:10}}),_(d)?d.value=1:d=1,w.value=10)),onKeydown:e[2]||(e[2]=ue(t=>(s(c).push({query:{search:s(V),page:1,pageSize:10}}),_(d)?d.value=1:d=1,w.value=10),["enter"])),label:"Поиск",modelValue:s(V),"onUpdate:modelValue":e[3]||(e[3]=t=>_(V)?V.value=t:V=t),"aria-label":"Поиск",variant:"outlined",clearable:"","append-inner-icon":fe,density:"compact",color:"info"},null,8,["modelValue"])]),u("div",Fe,[a(ee,null,{default:m(()=>{var t,I;return[u("thead",null,[u("tr",null,[(y(),b($,null,E(B,p=>u("th",$e,T(p.title),1)),64))])]),u("tbody",null,[C.value&&((t=C.value)==null?void 0:t.length)>0?(y(!0),b($,{key:0},E(C.value,p=>(y(),b("tr",null,[(y(),b($,null,E(B,({key:x})=>{var K;return u("td",{class:de(x==="created_by"?"text-center":"text-left"),onClick:H(L=>x==="note"&&X(p.note),["prevent"]),style:pe(x==="note"&&"cursor:pointer")},[x==="note"?(y(),P(Y,{key:0,text:p.note,activator:"parent",location:"bottom"},null,8,["text"])):z("",!0),S(" "+T(p[x]===p.note?((K=p.note)==null?void 0:K.length)>15?p.note.slice(0,10)+"...":p.note:p[x])+" ",1),u("div",He,[x=="actions"?(y(),P(U,{key:0,icon:s(me),color:"orange",onClick:L=>(_(r)?r.value=!0:r=!0,_(n)?n.value=p:n=p)},null,8,["icon","onClick"])):z("",!0),x=="actions"?(y(),P(U,{key:1,color:"green",icon:s(_e),onClick:L=>(_(v)?v.value=!0:v=!0,_(n)?n.value=p:n=p)},null,8,["icon","onClick"])):z("",!0)])],14,Ee)}),64))]))),256)):C.value&&((I=C.value)==null?void 0:I.length)==0?(y(),b("tr",Pe,Be)):z("",!0)])]}),_:1}),u("div",Ue,[u("p",je,"Всего записей: "+T(F.value),1),a(te,{class:"select",modelValue:w.value,"onUpdate:modelValue":[e[4]||(e[4]=t=>w.value=t),J],items:Z,density:"compact","hide-details":"",variant:"outlined"},null,8,["modelValue"]),a(le,{length:F.value,modelValue:s(d),"onUpdate:modelValue":[e[5]||(e[5]=t=>_(d)?d.value=t:d=t),O],density:"comfortable"},null,8,["length","modelValue"])])]),a(G,{modelValue:s(r),"onUpdate:modelValue":e[7]||(e[7]=t=>_(r)?r.value=t:r=t),width:"500"},{default:m(()=>[a(R,{title:"Создать",subtitle:"Создание записи"},{default:m(()=>[a(A,{onSubmit:H(Q,["prevent"]),id:"create-form",class:"w-100 px-3 mt-5"},{default:m(()=>[a(h,{name:"fio","model-value":s(n)&&s(n).name,variant:"outlined",label:"Ф.И.О",density:"compact",color:"info",rules:[t=>!!t||"Ф.И.О обязательное поле"]},null,8,["model-value","rules"]),a(h,{name:"phone","model-value":s(n)&&s(n).phone,variant:"outlined",label:"Телефон",density:"compact",color:"info",rules:[t=>!!t||"Телефон обязательное поле"]},null,8,["model-value","rules"]),a(h,{name:"pinfl","model-value":s(n)&&s(n).pinfl,variant:"outlined",label:"Пинфл",density:"compact",color:"info",rules:[t=>!!t||"Пинфл обязательное поле"]},null,8,["model-value","rules"]),a(ae,{"auto-grow":!0,name:"note","model-value":s(n)&&s(n).note,variant:"outlined",label:"Примечание",density:"compact",color:"info",rules:[t=>!!t||"Примечание обязательное поле"]},null,8,["model-value","rules"]),a(h,{name:"created_by","model-value":s(n)&&s(n).created_by,variant:"outlined",label:"Номер оператора",density:"compact",color:"info",rules:[t=>!!t||"Обязательное поле"]},null,8,["model-value","rules"]),a(M,null,{default:m(()=>[a(j),a(o,{color:"red",onClick:e[6]||(e[6]=t=>_(r)?r.value=!1:r=!1)},{default:m(()=>[S("Отмена")]),_:1}),a(o,{color:"info",type:"submit",form:"create-form"},{default:m(()=>[S("Сохранить")]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"]),a(G,{modelValue:s(v),"onUpdate:modelValue":e[9]||(e[9]=t=>_(v)?v.value=t:v=t),width:"500"},{default:m(()=>[a(R,{title:"Завершить",subtitle:"Чтобы завершить запись укажите номер оператора"},{default:m(()=>[a(A,{id:"end-form",onSubmit:H(W,["prevent"]),class:"w-100 px-3 mt-5"},{default:m(()=>[a(h,{name:"operator_number",variant:"outlined",label:"Номер оператора",density:"compact",color:"info",rules:[t=>!!t||"Обязательное поле"]},null,8,["rules"]),a(M,null,{default:m(()=>[a(j),a(o,{color:"red",onClick:e[8]||(e[8]=t=>_(v)?v.value=!1:v=!1)},{default:m(()=>[S("Отмена")]),_:1}),a(o,{color:"info",type:"submit",form:"end-form"},{default:m(()=>[S("Сохранить")]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"])])}}};export{Re as default};
