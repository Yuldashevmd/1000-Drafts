import{_ as le,c as f,d as v,e as i,t as z,l as T,x as ne,u as oe,a as se,r as h,o as re,w as ie,b as m,f as a,j as s,i as _,g as b,h as ce,s as V,F as D,k as E,m as F,n as ue,p as de,q as G}from"./index-0dec16da.js";import{a as N,M as pe,S as I}from"./sweetalert2-672e3bf0.js";const me={name:"PlusIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},_e=["aria-hidden","aria-label"],fe=["fill","width","height"],ye={d:"M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"},ve={key:0};function ge(y,c,l,r,u,d){return f(),v("span",ne(y.$attrs,{"aria-hidden":l.title?null:!0,"aria-label":l.title,class:"material-design-icon plus-icon",role:"img",onClick:c[0]||(c[0]=k=>y.$emit("click",k))}),[(f(),v("svg",{fill:l.fillColor,class:"material-design-icon__svg",width:l.size,height:l.size,viewBox:"0 0 24 24"},[i("path",ye,[l.title?(f(),v("title",ve,z(l.title),1)):T("",!0)])],8,fe))],16,_e)}const he=le(me,[["render",ge]]),be=async(y,c,l)=>N.get("getAll",{params:{search:y,page:c,pageSize:l}}).then(r=>r.data),xe=async y=>N.post("drafts",y).then(c=>c.data),Ve=async y=>N.post("moveToHistory",y).then(c=>c.data);const ke={class:"home"},Se=i("div",{class:"title_part h-25",style:{width:"fit-content","border-radius":"4px","background-color":"grey",padding:"8px 16px",color:"#fff"}},[i("h1",null,"Главная")],-1),we={class:"create_part w-100 my-3 d-flex justify-end"},Ce={class:"search_part w-100 my-3"},qe={class:"table_part"},ze={class:"text-left"},Te=["onClick"],He={key:1},De=i("td",{class:"text-center my-4",style:{"font-weight":"600"}}," Ничего не найдено ",-1),Ee=[De],Fe={class:"w-100 d-flex align-center justify-end my-3"},Ne={class:"text mr-3"},je={__name:"Home",setup(y){const c=oe(),l=se();let r=h(Number(l.query.page)||1),u=h(!1),d=h(!1),k=h(null),S=h(l.query.search||"");const K=["10","20","50","100"],C=h(l.query.pageSize||10),H=h(0),w=h([]),q=async()=>{const o=await be(l.query.search,l.query.page,l.query.pageSize);H.value=o.total,w.value=o.search};re(async()=>{await q()}),ie(()=>({search:l.query.search,page:l.query.page,pageSize:l.query.pageSize}),async()=>{await q()});const L=async o=>{C.value=o,c.push({query:{search:l.query.search,page:l.query.page,pageSize:o}})},Z=async o=>{r.value=o,c.push({query:{search:l.query.search,page:o,pageSize:l.query.pageSize}})},J=async o=>{const e=new FormData(o.currentTarget),n={name:e.get("fio"),phone:e.get("phone"),pinfl:e.get("pinfl"),note:e.get("note"),created_by:e.get("created_by")};n.name&&n.phone&&n.pinfl&&n.created_by&&n.note?await xe(n)&&(u.value=!1,I.fire({title:"Успех",text:"Запись создана",icon:"success"}),q()):console.log("Fill all fields")},O=async o=>{const e=new FormData(o.currentTarget),n={id:k.value.id,end_by:e.get("operator_number")};n.end_by?await Ve(n)&&(d.value=!1,I.fire({title:"Успех",text:"Запись завершена",icon:"success"}),q()):console.log("Fill all fields")},Q=async o=>{if(navigator.clipboard)try{await navigator.clipboard.writeText(o),alert("Text copied to clipboard!")}catch(e){console.error("Failed to copy text: ",e)}else{const e=document.createElement("textarea");e.value=o,e.style.position="absolute",e.style.left="-999999px",document.body.prepend(e),e.select();try{document.execCommand("copy")}catch(n){console.error(n)}finally{e.remove()}}},$=[{title:"№",key:"id"},{title:"ФИО",key:"name"},{title:"Телефон",key:"phone"},{title:"Пинфл",key:"pinfl"},{title:"Примечание",key:"note"},{title:"Создано",key:"created_at"},{title:"Оператор создал",key:"created_by"},{title:"Действия",key:"actions"}];return(o,e)=>{const n=m("v-btn"),g=m("v-text-field"),W=m("v-tooltip"),X=m("v-table"),Y=m("v-select"),ee=m("v-pagination"),te=m("v-textarea"),P=m("v-spacer"),j=m("v-card-actions"),B=m("v-form"),M=m("v-card"),U=m("v-dialog");return f(),v("section",ke,[Se,i("div",we,[a(n,{color:"info","prepend-icon":he,class:"d-flex align-center justify-center",onClick:e[0]||(e[0]=t=>_(u)?u.value=!0:u=!0)},{default:s(()=>[V("Создать")]),_:1})]),i("div",Ce,[a(g,{"onClick:appendInner":e[1]||(e[1]=t=>(b(c).push({query:{search:b(S),page:1,pageSize:10}}),_(r)?r.value=1:r=1,C.value=10)),onKeydown:e[2]||(e[2]=ce(t=>(b(c).push({query:{search:b(S),page:1,pageSize:10}}),_(r)?r.value=1:r=1,C.value=10),["enter"])),label:"Поиск",modelValue:b(S),"onUpdate:modelValue":e[3]||(e[3]=t=>_(S)?S.value=t:S=t),"aria-label":"Поиск",variant:"outlined",clearable:"","append-inner-icon":pe,density:"compact",color:"info"},null,8,["modelValue"])]),i("div",qe,[a(X,null,{default:s(()=>{var t,R;return[i("thead",null,[i("tr",null,[(f(),v(D,null,E($,p=>i("th",ze,z(p.title),1)),64))])]),i("tbody",null,[w.value&&((t=w.value)==null?void 0:t.length)>0?(f(!0),v(D,{key:0},E(w.value,p=>(f(),v("tr",null,[(f(),v(D,null,E($,({key:x})=>{var A;return i("td",{class:ue(x==="created_by"?"text-center":"text-left"),onClick:F(ae=>x==="note"&&Q(p.note),["prevent"]),style:de(x==="note"&&"cursor:pointer")},[x==="note"?(f(),G(W,{key:0,text:p.note,activator:"parent",location:"bottom"},null,8,["text"])):T("",!0),V(" "+z(p[x]===p.note?((A=p.note)==null?void 0:A.length)>15?p.note.slice(0,10)+"...":p.note:p[x])+" ",1),x=="actions"?(f(),G(n,{key:1,color:"warning",class:"d-flex align-center justify-center",onClick:ae=>(_(d)?d.value=!0:d=!0,_(k)?k.value=p:k=p)},{default:s(()=>[V(" Завершить ")]),_:2},1032,["onClick"])):T("",!0)],14,Te)}),64))]))),256)):w.value&&((R=w.value)==null?void 0:R.length)==0?(f(),v("tr",He,Ee)):T("",!0)])]}),_:1}),i("div",Fe,[i("p",Ne,"Всего записей: "+z(H.value),1),a(Y,{class:"select",modelValue:C.value,"onUpdate:modelValue":[e[4]||(e[4]=t=>C.value=t),L],items:K,density:"compact","hide-details":"",variant:"outlined"},null,8,["modelValue"]),a(ee,{length:H.value,modelValue:b(r),"onUpdate:modelValue":[e[5]||(e[5]=t=>_(r)?r.value=t:r=t),Z],density:"comfortable"},null,8,["length","modelValue"])])]),a(U,{modelValue:b(u),"onUpdate:modelValue":e[7]||(e[7]=t=>_(u)?u.value=t:u=t),width:"500"},{default:s(()=>[a(M,{title:"Создать",subtitle:"Создание записи"},{default:s(()=>[a(B,{onSubmit:F(J,["prevent"]),id:"create-form",class:"w-100 px-3 mt-5"},{default:s(()=>[a(g,{name:"fio",variant:"outlined",label:"Ф.И.О",density:"compact",color:"info",rules:[t=>!!t||"Ф.И.О обязательное поле"]},null,8,["rules"]),a(g,{name:"phone",variant:"outlined",label:"Телефон",density:"compact",color:"info",rules:[t=>!!t||"Телефон обязательное поле"]},null,8,["rules"]),a(g,{name:"pinfl",variant:"outlined",label:"Пинфл",density:"compact",color:"info",rules:[t=>!!t||"Пинфл обязательное поле"]},null,8,["rules"]),a(te,{"auto-grow":!0,name:"note",variant:"outlined",label:"Примечание",density:"compact",color:"info",rules:[t=>!!t||"Примечание обязательное поле"]},null,8,["rules"]),a(g,{name:"created_by",variant:"outlined",label:"Номер оператора",density:"compact",color:"info",rules:[t=>!!t||"Обязательное поле"]},null,8,["rules"]),a(j,null,{default:s(()=>[a(P),a(n,{color:"red",onClick:e[6]||(e[6]=t=>_(u)?u.value=!1:u=!1)},{default:s(()=>[V("Отмена")]),_:1}),a(n,{color:"info",type:"submit",form:"create-form"},{default:s(()=>[V("Сохранить")]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"]),a(U,{modelValue:b(d),"onUpdate:modelValue":e[9]||(e[9]=t=>_(d)?d.value=t:d=t),width:"500"},{default:s(()=>[a(M,{title:"Завершить",subtitle:"Чтобы завершить запись укажите номер оператора"},{default:s(()=>[a(B,{id:"end-form",onSubmit:F(O,["prevent"]),class:"w-100 px-3 mt-5"},{default:s(()=>[a(g,{name:"operator_number",variant:"outlined",label:"Номер оператора",density:"compact",color:"info",rules:[t=>!!t||"Обязательное поле"]},null,8,["rules"]),a(j,null,{default:s(()=>[a(P),a(n,{color:"red",onClick:e[8]||(e[8]=t=>_(d)?d.value=!1:d=!1)},{default:s(()=>[V("Отмена")]),_:1}),a(n,{color:"info",type:"submit",form:"end-form"},{default:s(()=>[V("Сохранить")]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"])])}}};export{je as default};
