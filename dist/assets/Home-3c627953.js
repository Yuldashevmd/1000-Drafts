import{_ as le,c as p,d as y,e as c,t as z,l as $,x as ae,b as d,q as N,j as r,f as a,y as ne,u as oe,a as se,r as b,o as ie,w as re,i as g,g as x,h as ce,s as w,F as D,k as H,m as F,n as ue,p as de}from"./index-91bd0ada.js";import{a as P,M as pe,S as A}from"./sweetalert2-978c3cd6.js";const _e={name:"PlusIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},me=["aria-hidden","aria-label"],fe=["fill","width","height"],ge={d:"M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"},ye={key:0};function ve(_,n,l,o,m,f){return p(),y("span",ae(_.$attrs,{"aria-hidden":l.title?null:!0,"aria-label":l.title,class:"material-design-icon plus-icon",role:"img",onClick:n[0]||(n[0]=v=>_.$emit("click",v))}),[(p(),y("svg",{fill:l.fillColor,class:"material-design-icon__svg",width:l.size,height:l.size,viewBox:"0 0 24 24"},[c("path",ge,[l.title?(p(),y("title",ye,z(l.title),1)):$("",!0)])],8,fe))],16,me)}const he=le(_e,[["render",ve]]),I={__name:"Dialog",props:{dialog:Boolean,width:String,title:String,subtitle:String},setup(_){const n=_;return(l,o)=>{const m=d("v-card"),f=d("v-dialog");return p(),N(f,{modelValue:n.dialog,"onUpdate:modelValue":o[0]||(o[0]=v=>n.dialog=v),width:"auto"},{default:r(()=>[a(m,{width:n.width,title:n.title,subtitle:n.subtitle},{default:r(()=>[ne(l.$slots,"default")]),_:3},8,["width","title","subtitle"])]),_:3},8,["modelValue"])}}},be=async(_,n,l)=>P.get("getAll",{params:{search:_,page:n,pageSize:l}}).then(o=>o.data),xe=async _=>P.post("drafts",_).then(n=>n.data),Se=async _=>P.post("moveToHistory",_).then(n=>n.data);const we={class:"home"},ke=c("div",{class:"title_part h-25",style:{width:"fit-content","border-radius":"4px","background-color":"grey",padding:"8px 16px",color:"#fff"}},[c("h1",null,"Главная")],-1),Ve={class:"create_part w-100 my-3 d-flex justify-end"},Ce={class:"search_part w-100 my-3"},qe={class:"table_part"},ze={class:"text-left"},$e=["onClick"],Te={key:1},De=c("td",{class:"text-center my-4",style:{"font-weight":"600"}}," Ничего не найдено ",-1),He=[De],Fe={class:"w-100 d-flex align-center justify-end my-3"},Ne={class:"text mr-3"},Ee={__name:"Home",setup(_){const n=oe(),l=se();let o=b(Number(l.query.page)||1),m=b(!1),f=b(!1),v=b(null),k=b(l.query.search||"");const G=["10","20","50","100"],C=b(l.query.pageSize||10),T=b(0),V=b([]),q=async()=>{const i=await be(l.query.search,l.query.page,l.query.pageSize);T.value=i.total,V.value=i.search};ie(async()=>{await q()}),re(()=>({search:l.query.search,page:l.query.page,pageSize:l.query.pageSize}),async()=>{await q()});const K=async i=>{C.value=i,n.push({query:{search:l.query.search,page:l.query.page,pageSize:i}})},L=async i=>{o.value=i,n.push({query:{search:l.query.search,page:i,pageSize:l.query.pageSize}})},Z=async i=>{const t=new FormData(i.currentTarget),s={name:t.get("fio"),phone:t.get("phone"),pinfl:t.get("pinfl"),note:t.get("note"),created_by:t.get("created_by")};s.name&&s.phone&&s.pinfl&&s.created_by&&s.note?await xe(s)&&(m.value=!1,A.fire({title:"Успех",text:"Запись создана",icon:"success"}),q()):console.log("Fill all fields")},J=async i=>{const t=new FormData(i.currentTarget),s={id:v.value.id,end_by:t.get("operator_number")};s.end_by?await Se(s)&&(f.value=!1,A.fire({title:"Успех",text:"Запись завершена",icon:"success"}),q()):console.log("Fill all fields")},O=async i=>{if(navigator.clipboard)try{await navigator.clipboard.writeText(i),alert("Text copied to clipboard!")}catch(t){console.error("Failed to copy text: ",t)}else console.error("Clipboard API not supported")},B=[{title:"№",key:"id"},{title:"ФИО",key:"name"},{title:"Телефон",key:"phone"},{title:"Пинфл",key:"pinfl"},{title:"Примечание",key:"note"},{title:"Создано",key:"created_at"},{title:"Оператор создал",key:"created_by"},{title:"Действия",key:"actions"}];return(i,t)=>{const s=d("v-btn"),h=d("v-text-field"),Q=d("v-tooltip"),W=d("v-table"),X=d("v-select"),Y=d("v-pagination"),ee=d("v-textarea"),E=d("v-spacer"),j=d("v-card-actions"),M=d("v-form");return p(),y("section",we,[ke,c("div",Ve,[a(s,{color:"info","prepend-icon":he,class:"d-flex align-center justify-center",onClick:t[0]||(t[0]=e=>g(m)?m.value=!0:m=!0)},{default:r(()=>[w("Создать")]),_:1})]),c("div",Ce,[a(h,{"onClick:appendInner":t[1]||(t[1]=e=>(x(n).push({query:{search:x(k),page:1,pageSize:10}}),g(o)?o.value=1:o=1,C.value=10)),onKeydown:t[2]||(t[2]=ce(e=>(x(n).push({query:{search:x(k),page:1,pageSize:10}}),g(o)?o.value=1:o=1,C.value=10),["enter"])),label:"Поиск",modelValue:x(k),"onUpdate:modelValue":t[3]||(t[3]=e=>g(k)?k.value=e:k=e),"aria-label":"Поиск",variant:"outlined",clearable:"","append-inner-icon":pe,density:"compact",color:"info"},null,8,["modelValue"])]),c("div",qe,[a(W,null,{default:r(()=>{var e,R;return[c("thead",null,[c("tr",null,[(p(),y(D,null,H(B,u=>c("th",ze,z(u.title),1)),64))])]),c("tbody",null,[V.value&&((e=V.value)==null?void 0:e.length)>0?(p(!0),y(D,{key:0},H(V.value,u=>(p(),y("tr",null,[(p(),y(D,null,H(B,({key:S})=>{var U;return c("td",{class:ue(S==="created_by"?"text-center":"text-left"),onClick:F(te=>S==="note"&&O(u.note),["prevent"]),style:de(S==="note"&&"cursor:pointer")},[S==="note"?(p(),N(Q,{key:0,text:u.note,activator:"parent",location:"bottom"},null,8,["text"])):$("",!0),w(" "+z(u[S]===u.note?((U=u.note)==null?void 0:U.length)>15?u.note.slice(0,10)+"...":u.note:u[S])+" ",1),S=="actions"?(p(),N(s,{key:1,color:"warning",class:"d-flex align-center justify-center",onClick:te=>(g(f)?f.value=!0:f=!0,g(v)?v.value=u:v=u)},{default:r(()=>[w(" Завершить ")]),_:2},1032,["onClick"])):$("",!0)],14,$e)}),64))]))),256)):V.value&&((R=V.value)==null?void 0:R.length)==0?(p(),y("tr",Te,He)):$("",!0)])]}),_:1}),c("div",Fe,[c("p",Ne,"Всего записей: "+z(T.value),1),a(X,{class:"select",modelValue:C.value,"onUpdate:modelValue":[t[4]||(t[4]=e=>C.value=e),K],items:G,density:"compact","hide-details":"",variant:"outlined"},null,8,["modelValue"]),a(Y,{length:T.value,modelValue:x(o),"onUpdate:modelValue":[t[5]||(t[5]=e=>g(o)?o.value=e:o=e),L],density:"comfortable"},null,8,["length","modelValue"])])]),a(I,{dialog:x(m),width:"500",title:"Создать",subtitle:"Создание записи"},{default:r(()=>[a(M,{onSubmit:F(Z,["prevent"]),id:"create-form",class:"w-100 px-3 mt-5"},{default:r(()=>[a(h,{name:"fio",variant:"outlined",label:"Ф.И.О",density:"compact",color:"info",rules:[e=>!!e||"Ф.И.О обязательное поле"]},null,8,["rules"]),a(h,{name:"phone",variant:"outlined",label:"Телефон",density:"compact",color:"info",rules:[e=>!!e||"Телефон обязательное поле"]},null,8,["rules"]),a(h,{name:"pinfl",variant:"outlined",label:"Пинфл",density:"compact",color:"info",rules:[e=>!!e||"Пинфл обязательное поле"]},null,8,["rules"]),a(ee,{"auto-grow":!0,name:"note",variant:"outlined",label:"Примечание",density:"compact",color:"info",rules:[e=>!!e||"Примечание обязательное поле"]},null,8,["rules"]),a(h,{name:"created_by",variant:"outlined",label:"Номер оператора",density:"compact",color:"info",rules:[e=>!!e||"Обязательное поле"]},null,8,["rules"]),a(j,null,{default:r(()=>[a(E),a(s,{color:"red",onClick:t[6]||(t[6]=e=>g(m)?m.value=!1:m=!1)},{default:r(()=>[w("Отмена")]),_:1}),a(s,{color:"info",type:"submit",form:"create-form"},{default:r(()=>[w("Сохранить")]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1},8,["dialog"]),a(I,{dialog:x(f),title:"Завершить",subtitle:"Чтобы завершить запись укажите номер оператора"},{default:r(()=>[a(M,{id:"end-form",onSubmit:F(J,["prevent"]),class:"w-100 px-3 mt-5"},{default:r(()=>[a(h,{name:"operator_number",variant:"outlined",label:"Номер оператора",density:"compact",color:"info",rules:[e=>!!e||"Обязательное поле"]},null,8,["rules"]),a(j,null,{default:r(()=>[a(E),a(s,{color:"red",onClick:t[7]||(t[7]=e=>g(f)?f.value=!1:f=!1)},{default:r(()=>[w("Отмена")]),_:1}),a(s,{color:"info",type:"submit",form:"end-form"},{default:r(()=>[w("Сохранить")]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1},8,["dialog"])])}}};export{Ee as default};
