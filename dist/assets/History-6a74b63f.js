import{u as $,a as A,r as h,o as D,w as L,b as y,c as i,d as _,e as s,f as m,g as u,i as f,h as J,j as O,t as k,F as q,k as S,l as z,n as Q,m as W,p as X,q as T,s as Y,v as Z}from"./index-8bd91e8e.js";import{a as B,M as ee,S as te}from"./sweetalert2-132f1113.js";const ae=async(v,r,e)=>B.get("getHistory",{params:{search:v,page:r,pageSize:e}}).then(a=>a.data),ne=async v=>B.post("getFromHistory",v).then(r=>r.data);const oe={class:"history"},se=s("div",{class:"title_part h-25",style:{width:"fit-content","border-radius":"4px","background-color":"grey",padding:"8px 16px",color:"#fff"}},[s("h1",null,"История")],-1),le={class:"search_part w-100 my-3"},re={class:"table_part"},ie={class:"text-left"},ce=["onClick"],ue={key:1},de=s("td",{class:"text-center my-4",style:{"font-weight":"600"}}," Ничего не найдено ",-1),pe=[de],ye={class:"w-100 d-flex align-center justify-end my-3"},_e={class:"text mr-3"},ve={__name:"History",setup(v){const r=$(),e=A();let a=h(Number(e.query.page)||1),d=h(e.query.search||"");const R=["10","20","50","100"],g=h(e.query.pageSize||10),b=h(0),p=h([]),x=async()=>{const n=await ae(e.query.search,e.query.page,e.query.pageSize);b.value=n.total,p.value=n.search};D(async()=>{await x()}),L(()=>({search:e.query.search,page:e.query.page,pageSize:e.query.pageSize}),async()=>{await x()});const F=async n=>{g.value=n,r.push({query:{search:e.query.search,page:e.query.page,pageSize:n}})},M=async n=>{a.value=n,r.push({query:{search:e.query.search,page:n,pageSize:e.query.pageSize}})},P=async n=>{const t={id:n.id};await ne(t)&&(te.fire({title:"Успех",text:"Запись вернулась",icon:"success"}),await x())},U=async n=>{if(navigator.clipboard)try{await navigator.clipboard.writeText(n),alert("Text copied to clipboard!")}catch(t){console.error("Failed to copy text: ",t)}else console.error("Clipboard API not supported")},C=[{title:"№",key:"id"},{title:"ФИО",key:"name"},{title:"Телефон",key:"phone"},{title:"Пинфл",key:"pinfl"},{title:"Примечание",key:"note"},{title:"Создано",key:"created_at"},{title:"Оператор создал",key:"created_by"},{title:"Оператор завершил",key:"end_by"},{title:"Действия",key:"actions"}];return(n,t)=>{const V=y("v-text-field"),E=y("v-tooltip"),H=y("v-icon"),j=y("v-table"),G=y("v-select"),I=y("v-pagination");return i(),_("section",oe,[se,s("div",le,[m(V,{"onClick:appendInner":t[0]||(t[0]=o=>(u(r).push({query:{search:u(d),page:1,pageSize:10}}),f(a)?a.value=1:a=1,g.value=10)),onKeydown:t[1]||(t[1]=J(o=>(u(r).push({query:{search:u(d),page:1,pageSize:10}}),f(a)?a.value=1:a=1,g.value=10),["enter"])),label:"Поиск",modelValue:u(d),"onUpdate:modelValue":t[2]||(t[2]=o=>f(d)?d.value=o:d=o),"aria-label":"Поиск",variant:"outlined",clearable:"","append-inner-icon":ee,density:"compact",color:"info"},null,8,["modelValue"])]),s("div",re,[m(j,null,{default:O(()=>{var o,w;return[s("thead",null,[s("tr",null,[(i(),_(q,null,S(C,l=>s("th",ie,k(l.title),1)),64))])]),s("tbody",null,[p.value&&((o=p.value)==null?void 0:o.length)>0?(i(!0),_(q,{key:0},S(p.value,l=>(i(),_("tr",null,[(i(),_(q,null,S(C,({key:c})=>{var N;return s("td",{class:Q(c==="created_by"?"text-center":"text-left"),onClick:W(K=>c==="note"&&U(l.note),["prevent"]),style:X(c==="note"&&"cursor:pointer")},[c==="note"?(i(),T(E,{key:0,text:l.note,activator:"parent",location:"bottom"},null,8,["text"])):z("",!0),Y(" "+k(l[c]===l.note?((N=l.note)==null?void 0:N.length)>15?l.note.slice(0,10)+"...":l.note:l[c])+" ",1),c=="actions"?(i(),T(H,{key:1,icon:u(Z),onClick:K=>P(l)},null,8,["icon","onClick"])):z("",!0)],14,ce)}),64))]))),256)):p.value&&((w=p.value)==null?void 0:w.length)==0?(i(),_("tr",ue,pe)):z("",!0)])]}),_:1}),s("div",ye,[s("p",_e,"Всего записей: "+k(b.value),1),m(G,{class:"select",modelValue:g.value,"onUpdate:modelValue":[t[3]||(t[3]=o=>g.value=o),F],items:R,density:"compact","hide-details":"",variant:"outlined"},null,8,["modelValue"]),m(I,{length:b.value,modelValue:u(a),"onUpdate:modelValue":[t[4]||(t[4]=o=>f(a)?a.value=o:a=o),M],density:"comfortable"},null,8,["length","modelValue"])])])])}}};export{ve as default};
